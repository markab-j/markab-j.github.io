import"./DsnmJJEf.js";import"./BSaoW0-a.js";import{f as n,a as p,af as l}from"./BS4WBKuF.js";const o={title:"mdsvex rehype-pretty-code 인코딩 문제 해결",description:"mdsvex에서는 rehype-pretty-code 플러그인이 동작하지 않아 다른 라이브러리를 사용하여 해결했다.",date:"2025-09-10",categories:["Svelte","Troubleshooting"],tags:["SvelteKit","mdsvex","rehype"]},{title:y,description:i,date:d,categories:D,tags:A}=o;var e=n(`<nav class="toc"><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#문제-상황">문제 상황</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#대체-플러그인">대체 플러그인</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#적용-과정">적용 과정</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#라이브러리-설치">라이브러리 설치</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#svelte-설정">svelte 설정</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#마치며">마치며</a></li></ol></nav><h2 id="문제-상황"><a aria-hidden="true" tabindex="-1" href="#문제-상황"><span class="icon icon-link"></span></a>문제 상황</h2> <p>rehype-pretty-code를 이용하여 코드블럭에 번호와 하이라이팅을 적용하려고 했지만 rehype 처리과정에서 코드 블럭 내부의 <code>&#123;</code>, <code>&#125;</code>가 <code>&&#8203;#123;</code> <code>&&#8203;#125;</code>로 인코딩되는 상황이었다.</p> <p>rehype-pretty-code에서 관련된 이슈를 찾아보았다.</p> <p><a href="https://github.com/rehype-pretty/rehype-pretty-code/issues/73" rel="nofollow">MDsveX compatible?</a></p> <p>mdsvex에서 코드 블럭을 파싱할때 인코딩을 두번하는 건지, 직접 하이라이터에서 <code>escapeSvelte</code>라는 함수를 중간에 호출하여 해결했다는 이슈였다.</p> <p>이슈의 마지막에는 대체 플러그인을 추천하고 있었다.</p> <h2 id="대체-플러그인"><a aria-hidden="true" tabindex="-1" href="#대체-플러그인"><span class="icon icon-link"></span></a>대체 플러그인</h2> <p>해당 라이브러리의 설명은 아래와 같이 적혀있다.</p> <blockquote><p>Use Shiki to highlight code blocks in MDSvex files.</p></blockquote> <p>References에서 rehype-pretty-code를 언급하는 것을 보아 mdsvex에서 사용하기 위한 완전한 대체 플러그인임을 알 수 있었다.</p> <p>조금 아쉬운 점은 복사 버튼과 같은 추가 기능은 붙어있지 않고 단순히 코드 블럭의 디자인을 위한 데이터 슬롯 삽입과 번호, 하이라이팅 기능만 제공된다.</p> <h2 id="적용-과정"><a aria-hidden="true" tabindex="-1" href="#적용-과정"><span class="icon icon-link"></span></a>적용 과정</h2> <h3 id="라이브러리-설치"><a aria-hidden="true" tabindex="-1" href="#라이브러리-설치"><span class="icon icon-link"></span></a>라이브러리 설치</h3> <pre><code><span data-line-number="1"><span style="color: #DBD7CAEE">npm install @bitmachina/highlighter@1.0.0-alpha.6</span></span>
</code></pre> <p>or using bun</p> <pre><code><span data-line-number="1"><span style="color: #DBD7CAEE">bun add @bitmachina/highlighter@1.0.0-alpha.6</span></span>
</code></pre> <h3 id="svelte-설정"><a aria-hidden="true" tabindex="-1" href="#svelte-설정"><span class="icon icon-link"></span></a>svelte 설정</h3> <pre data-code-title="svelte.config.js"><code><span data-line-number="1"><span style="color: #CB7676">const </span><span style="color: #BD976A">config</span><span style="color: #CB7676"> </span><span style="color: #666666">=</span><span style="color: #CB7676"> </span><span style="color: #666666">&#123;</span></span>
<span data-line-number="2"><span style="color: #666666">	</span><span style="color: #758575DD">// Consult https://svelte.dev/docs/kit/integrations</span></span>
<span data-line-number="3"><span style="color: #666666">	</span><span style="color: #758575DD">// for more information about preprocessors</span></span>
<span data-line-number="4"><span style="color: #CB7676">	</span><span style="color: #B8A965">preprocess</span><span style="color: #666666">:</span><span style="color: #CB7676"> </span><span style="color: #666666">[</span></span>
<span data-line-number="5"><span style="color: #CB7676">		</span><span style="color: #80A665">vitePreprocess</span><span style="color: #666666">(),</span></span>
<span data-line-number="6"><span style="color: #CB7676">		</span><span style="color: #80A665">mdsvex</span><span style="color: #666666">(&#123;</span></span>
<span data-line-number="7"><span style="color: #CB7676">			</span><span style="color: #B8A965">extensions</span><span style="color: #666666">:</span><span style="color: #CB7676"> </span><span style="color: #666666">[</span><span style="color: #C98A7DAA">&quot;</span><span style="color: #C98A7D">.md</span><span style="color: #C98A7DAA">&quot;</span><span style="color: #666666">],</span></span>
<span data-line-number="8"><span style="color: #CB7676">			</span><span style="color: #B8A965">rehypePlugins</span><span style="color: #666666">:</span><span style="color: #CB7676"> </span><span style="color: #666666">[</span><span style="color: #BD976A">rehypeSlug</span><span style="color: #666666">,</span><span style="color: #CB7676"> </span><span style="color: #BD976A">rehypeAutolinkHeadings</span><span style="color: #666666">,</span><span style="color: #CB7676"> </span><span style="color: #BD976A">rehypeToc</span><span style="color: #666666">],</span></span>
<span data-highlighted="" data-line-number="9"><span style="color: #CB7676">			</span><span style="color: #B8A965">highlight</span><span style="color: #666666">:</span><span style="color: #CB7676"> </span><span style="color: #666666">&#123;</span></span>
<span data-highlighted="" data-line-number="10"><span style="color: #CB7676">				</span><span style="color: #B8A965">highlighter</span><span style="color: #666666">:</span><span style="color: #CB7676"> </span><span style="color: #4D9375">await</span><span style="color: #CB7676"> </span><span style="color: #80A665">createHighlighter</span><span style="color: #666666">(&#123;</span><span style="color: #CB7676"> </span><span style="color: #B8A965">theme</span><span style="color: #666666">:</span><span style="color: #CB7676"> </span><span style="color: #C98A7DAA">&quot;</span><span style="color: #C98A7D">vitesse-dark</span><span style="color: #C98A7DAA">&quot;</span><span style="color: #CB7676"> </span><span style="color: #666666">&#125;),</span></span>
<span data-highlighted="" data-line-number="11"><span style="color: #CB7676">			</span><span style="color: #666666">&#125;,</span></span>
<span data-line-number="12"><span style="color: #CB7676">		</span><span style="color: #666666">&#125;),</span></span>
<span data-line-number="13"><span style="color: #CB7676">	</span><span style="color: #666666">],</span></span>
<span data-line-number="14"><span style="color: #CB7676">	</span><span style="color: #B8A965">kit</span><span style="color: #666666">:</span><span style="color: #CB7676"> </span><span style="color: #666666">&#123;</span></span>
<span data-line-number="15"><span style="color: #CB7676">		</span><span style="color: #B8A965">adapter</span><span style="color: #666666">:</span><span style="color: #CB7676"> </span><span style="color: #80A665">adapter</span><span style="color: #666666">(),</span></span>
<span data-line-number="16"><span style="color: #CB7676">	</span><span style="color: #666666">&#125;,</span></span>
<span data-line-number="17"><span style="color: #CB7676">	</span><span style="color: #B8A965">extensions</span><span style="color: #666666">:</span><span style="color: #CB7676"> </span><span style="color: #666666">[</span><span style="color: #C98A7DAA">&quot;</span><span style="color: #C98A7D">.svelte</span><span style="color: #C98A7DAA">&quot;</span><span style="color: #666666">,</span><span style="color: #CB7676"> </span><span style="color: #C98A7DAA">&quot;</span><span style="color: #C98A7D">.md</span><span style="color: #C98A7DAA">&quot;</span><span style="color: #666666">],</span></span>
<span data-line-number="18"><span style="color: #666666">&#125;;</span></span>
</code></pre> <p>rehype의 대부분의 플러그인은 css작업에 도움을 주는 id나 데이터 속성을 html 태그에 추가해주는 작업만 해주므로, 프로젝트의 css를 따로 작업해줘야 한다.</p> <p>나는 현재 아래처럼 사용하고 있다.</p> <pre data-code-title="app.css"><code data-line-numbers=""><span data-line-number="1"><span style="color: #4D9375">pre</span><span style="color: #666666">[</span><span style="color: #BD976A">data-code-title</span><span style="color: #666666">]:</span><span style="color: #BD976A">before</span><span style="color: #DBD7CAEE"> </span><span style="color: #666666">&#123;</span></span>
<span data-line-number="2"><span style="color: #DBD7CAEE">    @</span><span style="color: #B8A965">apply</span><span style="color: #DBD7CAEE"> </span><span style="color: #B8A965">dark</span><span style="color: #666666">:</span><span style="color: #DBD7CAEE">border-b-muted </span><span style="color: #C99076">block</span><span style="color: #DBD7CAEE"> min-h-6 border-b border-b-gray-700 pb-1 text-xs</span><span style="color: #666666">;</span></span>
<span data-line-number="3"><span style="color: #DBD7CAEE">    </span><span style="color: #B8A965">content</span><span style="color: #666666">:</span><span style="color: #DBD7CAEE"> </span><span style="color: #B8A965">attr</span><span style="color: #666666">(</span><span style="color: #BD976A">data-code-title</span><span style="color: #666666">);</span></span>
<span data-line-number="4"><span style="color: #DBD7CAEE">  </span><span style="color: #666666">&#125;</span></span>
<span data-line-number="5"></span>
<span data-line-number="6"><span style="color: #4D9375">pre</span><span style="color: #DBD7CAEE"> </span><span style="color: #CB7676">&gt;</span><span style="color: #DBD7CAEE"> </span><span style="color: #4D9375">code</span><span style="color: #DBD7CAEE"> </span><span style="color: #666666">&#123;</span></span>
<span data-line-number="7"><span style="color: #DBD7CAEE">    @</span><span style="color: #B8A965">apply</span><span style="color: #DBD7CAEE"> </span><span style="color: #B8A965">flex</span><span style="color: #DBD7CAEE"> </span><span style="color: #B8A965">flex-col</span><span style="color: #666666">;</span></span>
<span data-line-number="8"><span style="color: #DBD7CAEE">    </span><span style="color: #B8A965">font-family</span><span style="color: #666666">:</span><span style="color: #DBD7CAEE"> </span><span style="color: #C98A7DAA">&quot;</span><span style="color: #C98A7D">D2Coding</span><span style="color: #C98A7DAA">&quot;</span><span style="color: #666666">,</span><span style="color: #DBD7CAEE"> Consolas</span><span style="color: #666666">,</span><span style="color: #DBD7CAEE"> </span><span style="color: #C98A7DAA">&quot;</span><span style="color: #C98A7D">Courier New</span><span style="color: #C98A7DAA">&quot;</span><span style="color: #666666">,</span><span style="color: #DBD7CAEE"> </span><span style="color: #C99076">monospace</span><span style="color: #666666">;</span></span>
<span data-line-number="9"><span style="color: #DBD7CAEE">    </span><span style="color: #B8A965">tab-size</span><span style="color: #666666">:</span><span style="color: #DBD7CAEE"> </span><span style="color: #4C9A91">2</span><span style="color: #666666">;</span></span>
<span data-line-number="10"><span style="color: #DBD7CAEE">    </span><span style="color: #B8A965">font-variant-ligatures</span><span style="color: #666666">:</span><span style="color: #DBD7CAEE"> </span><span style="color: #C99076">common-ligatures</span><span style="color: #666666">;</span></span>
<span data-line-number="11"><span style="color: #DBD7CAEE">    </span><span style="color: #B8A965">-webkit-font-smoothing</span><span style="color: #666666">:</span><span style="color: #DBD7CAEE"> </span><span style="color: #C99076">antialiased</span><span style="color: #666666">;</span></span>
<span data-line-number="12"><span style="color: #DBD7CAEE">    </span><span style="color: #B8A965">-moz-osx-font-smoothing</span><span style="color: #666666">:</span><span style="color: #DBD7CAEE"> </span><span style="color: #C99076">grayscale</span><span style="color: #666666">;</span></span>
<span data-line-number="13"><span style="color: #666666">&#125;</span></span>
<span data-line-number="14"></span>
<span data-line-number="15"><span style="color: #4D9375">code</span><span style="color: #DBD7CAEE"> </span><span style="color: #CB7676">&gt;</span><span style="color: #DBD7CAEE"> </span><span style="color: #4D9375">span</span><span style="color: #DBD7CAEE"> </span><span style="color: #666666">&#123;</span></span>
<span data-line-number="16"><span style="color: #DBD7CAEE">    @</span><span style="color: #B8A965">apply</span><span style="color: #DBD7CAEE"> </span><span style="color: #B8A965">px-</span><span style="color: #DBD7CAEE">4</span><span style="color: #666666">;</span></span>
<span data-line-number="17"><span style="color: #666666">&#125;</span></span>
<span data-line-number="18"></span>
<span data-line-number="19"><span style="color: #4D9375">code</span><span style="color: #666666">[</span><span style="color: #BD976A">data-line-numbers</span><span style="color: #666666">]</span><span style="color: #DBD7CAEE"> </span><span style="color: #CB7676">&gt;</span><span style="color: #DBD7CAEE"> </span><span style="color: #4D9375">span</span><span style="color: #666666">[</span><span style="color: #BD976A">data-line-number</span><span style="color: #666666">]::</span><span style="color: #BD976A">before</span><span style="color: #DBD7CAEE"> </span><span style="color: #666666">&#123;</span></span>
<span data-line-number="20"><span style="color: #DBD7CAEE">    @</span><span style="color: #B8A965">apply</span><span style="color: #DBD7CAEE"> </span><span style="color: #B8A965">inline-block</span><span style="color: #DBD7CAEE"> </span><span style="color: #B8A965">w-</span><span style="color: #DBD7CAEE">4 </span><span style="color: #B8A965">mx-</span><span style="color: #DBD7CAEE">4 </span><span style="color: #B8A965">text-right</span><span style="color: #DBD7CAEE"> </span><span style="color: #B8A965">text-gray-</span><span style="color: #DBD7CAEE">500</span><span style="color: #666666">;</span></span>
<span data-line-number="21"><span style="color: #DBD7CAEE">    </span><span style="color: #B8A965">content</span><span style="color: #666666">:</span><span style="color: #DBD7CAEE"> </span><span style="color: #B8A965">attr</span><span style="color: #666666">(</span><span style="color: #BD976A">data-line-number</span><span style="color: #666666">);</span></span>
<span data-line-number="22"><span style="color: #666666">&#125;</span></span>
<span data-line-number="23"></span>
<span data-line-number="24"><span style="color: #4D9375">code</span><span style="color: #DBD7CAEE"> </span><span style="color: #CB7676">&gt;</span><span style="color: #DBD7CAEE"> </span><span style="color: #4D9375">span</span><span style="color: #666666">[</span><span style="color: #BD976A">data-highlighted</span><span style="color: #666666">]</span><span style="color: #DBD7CAEE"> </span><span style="color: #666666">&#123;</span></span>
<span data-line-number="25"><span style="color: #DBD7CAEE">    </span><span style="color: #B8A965">background</span><span style="color: #666666">:</span><span style="color: #DBD7CAEE"> </span><span style="color: #666666">#</span><span style="color: #C99076">3b4252</span><span style="color: #666666">;</span></span>
<span data-line-number="26"><span style="color: #DBD7CAEE">    </span><span style="color: #B8A965">width</span><span style="color: #666666">:</span><span style="color: #DBD7CAEE"> </span><span style="color: #4C9A91">100</span><span style="color: #CB7676">%</span><span style="color: #666666">;</span></span>
<span data-line-number="27"><span style="color: #666666">&#125;</span></span>
</code></pre> <p>현재 블로그에서 Tailwind를 사용하고 있기 때문에 @apply를 사용하여 적용해주었다.</p> <h2 id="마치며"><a aria-hidden="true" tabindex="-1" href="#마치며"><span class="icon icon-link"></span></a>마치며</h2> <p>새롭게 찾은 플러그인의 마지막 업데이트는 2년전이라 적용하기 좀 껄끄러웠다.</p> <p>하지만 생각해보면 shiki와 같은 종속 업데이트 또는 엣지 케이스가 나와 업데이트를 해야만하는 상황이 아니라면 굳이 업데이트할 필요가 없는 라이브러리라고 생각했다.</p> <p>실제로 적용했을 때도 큰 문제는 없었으니 계속 사용할 예정이다.</p> <p>코드 블럭 복사 버튼이 없는 것은 좀 많이 아쉽긴하다.</p>`,1);function B(s){var a=e();l(53),p(s,a)}export{B as default,o as metadata};
